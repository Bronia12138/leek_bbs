<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>排行榜 - 就业交流论坛</title>
    <link rel="icon" href="/leek_bbs/statics/images/favicon.ico">
    <link rel="stylesheet" href="/leek_bbs/statics/yu-ui/js_css/yu.css">
    <link rel="stylesheet" href="/leek_bbs/statics/layui/css/layui.css">
    <link rel="stylesheet" href="/leek_bbs/statics/bootstrap-3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="/leek_bbs/statics/css/head.css">
    <link rel="stylesheet" href="/leek_bbs/statics/css/modern-ui.css">

    <style>
        /* 仅在原基础上叠加现代视觉效果，不破坏原有类名逻辑 */
        body { background-color: #f6f8fa !important; }
        .ranking-page-wrapper { padding-top: 20px; }

        /* 侧边导航美化 */
        .side-nav-card { background: #fff; border: 1px solid #e1e4e8; border-radius: 8px; overflow: hidden; }
        .side-nav-item { padding: 12px 20px; cursor: pointer; border-left: 3px solid transparent; transition: 0.2s; }
        .side-nav-item:hover { background: #f3f4f6; color: #ff6f3d; }
        .side-nav-item.active { background: #fff7f3; color: #ff6f3d; border-left-color: #ff6f3d; font-weight: bold; }
        .side-nav-item h5 { margin: 0; font-size: 15px; }
        .side-nav-item a { color: inherit !important; text-decoration: none !important; }

        /* 内容卡片美化 */
        .main-content-card { background: #fff; border: 1px solid #e1e4e8; border-radius: 8px; padding: 10px 20px; min-height: 600px; }

        /* 原始类名样式增强 */
        .numberOn { background: #ff6f3d !important; color: #fff !important; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        .number { color: #8F8F8F; padding: 2px 8px; font-weight: bold; }

        .m-border-bottom {
            padding: 15px 10px;
            border-bottom: 1px solid #f1f1f1 !important;
            transition: background 0.2s;
            display: flex;
            align-items: center;
        }
        .m-border-bottom:hover { background-color: #fafafa !important; }

        /* 修复 Layui 选项卡在现代 UI 下的样式 */
        .layui-tab-brief > .layui-tab-title .layui-this { color: #ff6f3d !important; }
        .layui-tab-brief > .layui-tab-more li.layui-this:after,
        .layui-tab-brief > .layui-tab-title .layui-this:after { border-bottom: 2px solid #ff6f3d !important; }

        [v-cloak] { display: none; }
    </style>
</head>
<body>

<div id="modern-wrapper">
    <div id="hmc">
        <head_menu_comp :is_login="isLoginShow" ref="fo"></head_menu_comp>
    </div>

    <div class="container ranking-page-wrapper" id="rankApp" v-cloak>
        <div class="row" style="margin-bottom: 15px;">
            <div class="col-xs-12">
                <span style="opacity: .8;">
                    <a href="index.html"><span class="glyphicon glyphicon-home"></span></a>&nbsp;>&nbsp;
                    <a href="index.html">排行</a>&nbsp;>&nbsp;
                    <span id="current-pos">用户排行</span>
                </span>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-2">
                <div class="side-nav-card">
                    <div style="padding: 15px 20px; border-bottom: 1px solid #eee;"><strong>排行榜</strong></div>
                    <div class="side-nav-item active" id="userBtn"><h5><a href="javascript:;">用户排行</a></h5></div>
                    <div class="side-nav-item" id="postsBtn"><h5><a href="javascript:;">帖子排行</a></h5></div>
                    <div class="side-nav-item" id="plateBtn"><h5><a href="javascript:;">板块排行</a></h5></div>
                </div>
            </div>

            <div class="col-sm-10">
                <div class="main-content-card">

                    <div class="layui-tab layui-tab-brief" id="tab-user" lay-filter="tabUser">
                        <ul class="layui-tab-title">
                            <li class="layui-this">积分排行</li>
                            <li v-on:click="getuPost">发帖数排行</li>
                            <li v-on:click="getLogs">日志排行</li>
                            <li v-on:click="getExperience">经验排行</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <div class="m-border-bottom" v-for="(integral,index) in integrals">
                                    <div style="flex: 1; display: flex; align-items: center;">
                                        <span :class="(index <= 2) ? 'numberOn':'number'">{{index+1}}</span>
                                        <a :href="'/leek_bbs/skipPage/personal?id='+integral.id" :title="'进入'+integral.another_name+'空间'">
                                            <img :src="'/leek_bbs/'+integral.picture" class="img-circle" style="width: 48px;height: 48px;margin-left: 15px; margin-right: 15px;">
                                        </a>
                                        <div>
                                            <div style="font-weight: bold; font-size: 15px;">{{integral.another_name}}</div>
                                            <div style="color: #7f8da3; font-size: 13px;">积分数: <em style="color: #ff6f3d; font-style: normal; font-weight: bold;">{{integral.integral.total_integral}}</em></div>
                                        </div>
                                    </div>
                                    <a :href="'/leek_bbs/skipPage/personal?userId='+integral.id" class="btn btn-default btn-sm">去串个门</a>
                                </div>
                                <p style="padding: 15px 0; font-size: 12px; color: #999;">排行榜显示前10位数据</p>
                            </div>
                            <div class="layui-tab-item" v-for="type in ['essays', 'logs', 'experiences']">
                                <div class="m-border-bottom" v-for="(item,index) in $data[type]">
                                    <span :class="(index <= 2) ? 'numberOn':'number'">{{index+1}}</span>
                                    <a :href="'/leek_bbs/skipPage/personal?id='+item.id"><img :src="'/leek_bbs/'+item.picture" class="img-circle" style="width:48px;height:48px;margin:0 15px;"></a>
                                    <div style="flex: 1;">
                                        <div style="font-weight:bold;">{{item.another_name}}</div>
                                        <div style="color:#7f8da3;font-size:13px;">数量: <em>{{item.posts || item.log || item.total_experience}}</em></div>
                                    </div>
                                    <a :href="'/leek_bbs/skipPage/personal?id='+item.id" class="btn btn-default btn-sm">去串个门</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="layui-tab layui-tab-brief" id="tab-posts" lay-filter="tabPosts" style="display: none;">
                        <ul class="layui-tab-title">
                            <li class="layui-this">回复排行</li>
                            <li v-on:click="getBrowse">查看排行</li>
                            <li v-on:click="getShare">分享排行</li>
                            <li v-on:click="getCollect">收藏排行</li>
                            <li v-on:click="getHeat">热度排行</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <table class="table table-hover">
                                    <thead>
                                    <tr style="color: #7f8da3;"><th>排名</th><th>主题</th><th>板块</th><th>作者</th><th>回复</th></tr>
                                    </thead>
                                    <tbody>
                                    <tr v-for="(reply,index) in replys">
                                        <td><span :class="(index <= 2) ? 'numberOn':'number'">{{index+1}}</span></td>
                                        <td><a :href="'/leek_bbs/skipPage/blogPage?theme_id='+reply.id" @click="handleBrowseCount(reply.id)">{{reply.title}}</a></td>
                                        <td><span class="text-muted">{{reply.plate_name}}</span></td>
                                        <td><span style="font-size: 12px;">{{reply.post_author}}</span><br><small class="text-muted">{{reply.publish_time|format}}</small></td>
                                        <td><b style="color: #ff6f3d;">{{reply.reply_count}}</b></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="layui-tab-item" v-for="list in [browses, shares, collects, heats]">
                                <table class="table table-hover">
                                    <tbody>
                                    <tr v-for="(item,index) in list">
                                        <td width="60"><span :class="(index <= 2) ? 'numberOn':'number'">{{index+1}}</span></td>
                                        <td><a :href="'/leek_bbs/skipPage/blogPage?theme_id='+item.id" @click="handleBrowseCount(item.id)">{{item.title}}</a></td>
                                        <td class="text-right">数值：<b style="color:#ff6f3d">{{item.browse_count || item.share_count || item.post_collect || item.post_heat}}</b></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="layui-tab layui-tab-brief" id="tab-plate" lay-filter="tabPlate" style="display: none;">
                        <ul class="layui-tab-title">
                            <li class="layui-this">发帖排行</li>
                            <li v-on:click="getPosts">回复排行</li>
                            <li v-on:click="getTime">今日发帖排行</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <div class="m-border-bottom" v-for="(theme,index) in themes">
                                    <span style="flex: 1;">
                                        <span :class="(index <= 2) ? 'numberOn':'number'">{{index+1}}</span>
                                        &emsp;<a :href="'/leek_bbs/skipPage/model?pl_type='+theme.id" style="font-weight: bold; color: #333;">{{theme.plate_name}}</a>
                                    </span>
                                    <span style="color: #7f8da3;">发帖数：{{theme.theme}}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <footer style="margin-top: 50px; padding: 20px 0; border-top: 1px solid #eee;">
<!--        <p class="text-center text-muted">© 2026 就业交流论坛 版权所有</p>-->
        <div align="text-center center">
            <p style="text-align: center; color: #666; font-size: 14px; margin: 20px 0; line-height: 1.8;">
                <span>© 2026 就业交流论坛 版权所有</span>
                <br>
                <span>邮箱：hanser12581@gmail.com | 友链：www.bronia.xyz</span>
            </p>        </div>
    </footer>
</div>

<script src="/leek_bbs/statics/component/common_import.js"></script>
<script src="/leek_bbs/statics/component/head_menu.js"></script>
<script src="/leek_bbs/statics/js/my_project_rs.js"></script>

<script>
    // 1. 原始 Vue 逻辑：直接粘贴，不改动任何变量名和请求路径
    new Vue({
        el:'#rankApp',
        data:{
            integrals:[], essays:[], logs:[], browses:[], experiences:[],
            replys:[], shares:[], collects:[], heats:[], themes:[], postes:[], times:[],
            pageSize:10, pageNo:1,
        },
        methods: {
            handleBrowseCount(postId) {
                axios.get("/leek_bbs/bbs/postBrowse/clickAddBrowseCount", { params: { id: postId } })
                    .then(response => { if (response.data === 1) { this.integral(); } });
            },
            integral() { axios.post("/leek_bbs/bbs/rank/query",{pageSize:10,pageNo:1}).then(res => {this.integrals = res.data;}); },
            getuPost(){ axios.post("/leek_bbs/bbs/rank/selectPost",{pageSize:10,pageNo:1}).then(res => {this.essays = res.data;}); },
            getLogs(){ axios.post("/leek_bbs/bbs/rank/selectLog",{pageSize:10,pageNo:1}).then(res => {this.logs = res.data;}); },
            getExperience(){ axios.post("/leek_bbs/bbs/rank/selectExperience",{pageSize:10,pageNo:1}).then(res => {this.experiences = res.data;}); },
            reply(){ axios.post("/leek_bbs/bbs/rank/selectReply",{pageSize:10,pageNo:1}).then(res => {this.replys = res.data;}); },
            getBrowse(){ axios.post("/leek_bbs/bbs/rank/selectBrowse",{pageSize:10,pageNo:1}).then(res => {this.browses = res.data;}); },
            getShare(){ axios.post("/leek_bbs/bbs/rank/selectShare",{pageSize:10,pageNo:1}).then(res => {this.shares = res.data;}); },
            getCollect(){ axios.post("/leek_bbs/bbs/rank/selectCollect",{pageSize:10,pageNo:1}).then(res => {this.collects = res.data;}); },
            getHeat(){ axios.post("/leek_bbs/bbs/rank/selectHeat",{pageSize:10,pageNo:1}).then(res => {this.heats = res.data;}); },
            theme(){ axios.post("/leek_bbs/bbs/rank/selectTheme",{pageSize:10,pageNo:1}).then(res => {this.themes = res.data;}); },
            getPosts(){ axios.post("/leek_bbs/bbs/rank/selectPosts",{pageSize:10,pageNo:1}).then(res => {this.postes = res.data;}); },
            getTime(){ axios.get("/leek_bbs/bbs/rank/selectTime").then(res => { this.times = res.data.sort(compare('todayTotalTheme')); }); }
        },
        created(){ this.integral(); this.reply(); this.theme(); },
        filters: {
            format(value) {
                let date = new Date(value);
                return `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;
            }
        }
    });

    // 2. 修复后的侧边栏切换逻辑
    $(function() {
        $(".side-nav-item").click(function() {
            $(".side-nav-item").removeClass("active");
            $(this).addClass("active");

            var id = $(this).attr("id");
            // 切换大模块显隐
            $("#tab-user, #tab-posts, #tab-plate").hide();
            if(id === "userBtn") {
                $("#tab-user").show();
                $("#current-pos").text("用户排行");
            } else if(id === "postsBtn") {
                $("#tab-posts").show();
                $("#current-pos").text("帖子排行");
            } else if(id === "plateBtn") {
                $("#tab-plate").show();
                $("#current-pos").text("板块排行");
            }

            // 重要：切换后手动触发一次 Layui 渲染，确保内部 Tab 依然可用
            layui.use('element', function(){
                layui.element.render('tab');
            });
        });
    });

    function compare(property){ return function(a,b){ return b[property] - a[property]; } }
</script>
</body>
</html>
